\subsection{\textit{Ab initio} Polarization Propagator} \label{adc}

The \PSIadc\ code seeks the pole structure of the polarization propagator, which is equivalent to the correlated excitation energy, in terms of the second order algebraic-diagrammatic construction (ADC(2)) scheme. Originally, the ADC scheme was derived in purely the diagrammatic language by Schirmer\cite{Schirmer:1982} and later, a sophisticated algebraic scheme was developed by Trofimov et al.\cite{Trofimov:2006}. In general by \textit{n}-th order ADC theory, the excited state is treated at completely equivalent level to the M\o ller-Plesset perturbation expansion of the same order. Hence the ADC(2) can be described as MP2 theory for the excited state and the relation to such the other response theories as CC2-LR, CIS(D) and CIS(D${}_n$) has been addressed by H\"attig et al.\cite{Haettig:2002}. In the ADC theory, the residue calculus of the propagator is translated into the eigenvalue problem with respect to the correlated response matrix, or also known as the shifted-Hamiltonian. So, the $\sigma$-vectors are constructed for several times in the simultaneous expansion method (SEM), each of which costs O(N${}^5$) manipulation. In addition, the tensorial form of the $\sigma$-vector resembles to that of the doubles correction in the CIS(D) energetic equation. As a consequence, the pre-factor in the polynomial scaling becomes far larger than that of the CIS(D) even though the quasi-degeneracy of the excited state is properly accounted for in the ADC(2) model.

In \PSIfour\ the quite efficient and flexible integral-transformation library named {\tt libtrans} is newly equipped and utilized in the production level DCFT code. The \PSIadc\ code is also based on the {\tt libtrans}, and {\tt libdpd} a library to utilize molecular symmetry in the tensorial manipulations in framework of the direct-product decomposition algorithm. By this feature, the Ritz space and intermediate tensors are blocked-out into their symmetry allowed irrep blocks and the excited states that belong to different symmetry are sought separately.

In the output of \PSIadc\ , the ADC(2) results may look like as follows:
\begin{verbatim}
->  1 B1 state   :  0.2565095 (a.u.),  6.9799824 (eV)
    Non-iterative:  0.2565636 (a.u.),  6.9814532 (eV)
             Occ Vir        Coefficient
    ---------------------------------------------
              3   0        -0.9017047264
              3   2         0.3038332241
              3   1         0.2907567119
              3   5        -0.0790167706
              3   4        -0.0425829926
              
    Converged in   4 iteration.
    Squared norm of the S component:  0.9315336
    The S vector is rotated up to  8.102 (deg.)
\end{verbatim} 
in which the ADC(2) excitation energy is indicated with arrow symbol and the pseudo-perturbative value, which is calculated in very similar fashion to the CIS(D) energy, is also presented at the next line. In this implementation, the ADC(2) secular matrix is treated effectively by renormalization of the double excitation manifold into the single excitation manifold. So, the effective secular equation is solved for several times for the specific state due to the eigenvalue dependence of the effective response matrix. Only the S component of the transition amplitude is obtained explicitly and the squared norm of the S block and the rotation angle from the corresponding CIS vector are given below the element of the amplitude. Difference between the ADC(2) and its non-iterative values is mostly negligible if the immixture among the CIS excited states are small and the quasi-degeneracy in the excited state is tolerably weak. But if the discrepancy, or the rotation angle is visibly large specific care may have to be taken for the strong effects caused by the higher excited states. 

\subsubsection{Partial Renormalization Scheme}
The \PSIadc\ code is capable of performing the partially-renormalized ADC(2) computation, termed PR-ADC(2). In the perturbative treatment of the singly-excited state, the doubly and triply excited configurations are accounted for as in the case of CIS(D). In the language of the CIS(D), the former is regarded to introduce the orbital relaxation (OR) effect while the latter is argued to give rise to the differential correlation (DC) correction to the excited state. In the PR-ADC(2) scheme, the the DC term is corrected according to the ground state PR-MP2 correlation, in which the correlation between the electron pairs are accounted for in size-consistent and unitary-invariant fashion by modulating the MP1 amplitude. By utilizing the PR scheme, the substantial resistance against the quasi-degeneracy is readily granted as discussed in Ref. \cite{Saitow:2012}.

\subsubsection{Implementation}
Some very essential points are emphasized for understanding of the nature and the limitation of  the theory. The ADC(2) response matrix, denoted as $\mathbf{A}$, is expanded in the single (S) and double (D) excitation manifolds as 
\begin{equation*}
\begin{pmatrix}
\mathbf{A_{SS}^{(2)}} & \mathbf{A_{SD}^{(1)}}\\
\mathbf{A_{DS}^{(1)}} & \mathbf{A_{DD}^{(0)}}
\end{pmatrix}
\begin{pmatrix}
\mathbf{X_S}\\
\mathbf{X_D}
\end{pmatrix}
=\omega
\begin{pmatrix}
\mathbf{X_S}\\
\mathbf{X_D}
\end{pmatrix}
\end{equation*}
where the superscript on each matrix block indicates the order of the fluctuation. Instead of solving the above equation explicitly, the large D manifold is treated effectively as
\begin{equation*}
[\mathbf{A_{SS}^{(2)}}+\mathbf{A_{SD}^{(1)}}^{\dagger}(\omega-\mathbf{A_{DD}^{(0)}})^{-1}\mathbf{A_{DS}^{(1)}}]\mathbf{X_{S}}=\omega\mathbf{X_{S}}.
\end{equation*}
This form of the ADC(2) equation requires 7 - 10 iterations for convergence on only one root. But by favor of the Newton-Raphson acceleration, 
\begin{equation*}
\omega^{n+1}=\omega^{n}-\frac{\omega^n-\mathbf{X_{S}}(\omega^n)^{\dagger}[\mathbf{A_{SS}^{(2)}}+\mathbf{A_{SD}^{(1)}}^{\dagger}(\omega^n-\mathbf{A_{DD}^{(0)}})^{-1}\mathbf{A_{DS}^{(1)}}]\mathbf{X_{S}}(\omega^n)}{1+\mathbf{X_{S}}(\omega^n)^{\dagger}[\mathbf{A_{SD}^{(1)}}^{\dagger}(\omega^n-\mathbf{A_{DD}^{(0)}})^{-2}\mathbf{A_{DS}^{(1)}}]\mathbf{X_{S}}(\omega^n)}
\end{equation*}
the computational time reduces to shorter than half of the simple iterative procedure. Construction of the denominator of the second term in the above equation is rather lighter than that for one $\sigma$-vector with respect to the effective response matrix. The non-iterative excitation energy stated above is calculated as a diagonal element of the Davidson mini-Hamiltonian matrix in the SEM as,
\begin{equation*}
\omega^{Non-Iterative}=\mathbf{X_{CIS}}^{\dagger}[\mathbf{A_{SS}^{(2)}}+\mathbf{A_{SD}^{(1)}}^{\dagger}(\omega^{CIS}-\mathbf{A_{DD}^{(0)}})^{-1}\mathbf{A_{DS}^{(1)}}]\mathbf{X_{CIS}}
\end{equation*}
where $\omega^{CIS}$ and $\mathbf{X_{CIS}}$ denote the CIS excitation energy and wave function, respectively. Explicit form of the $\sigma$-vector is provided in the note: \verb|src/bin/adc/sigma.pdf|. 

\subsubsection{The Density-Fitted Version}
The density-fitted ADC(2) is given as a plugin \verb|plugin_dfadc|, which is still under development though, and requires quite large memory in order to store the DF vectors. I feel some more refinement may be desirable for routinely use to the large molecular systems.