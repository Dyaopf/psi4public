#! DF-SCF cc-pVDZ of benzene-hydronium ion, scanning the dissociation coordinate with
#! Python's built-in loop mechanism. The geometry is specified by a Z-matrix with dummy
#! atoms, fixed parameters, updated parameters, and separate charge/multiplicity
#! specifiers for each monomer. One-electron properties computed for dimer and one monomer.
 
memory 250 mb
refENuc   = [ 268.617178206587084, 13.021346299597003,  #TEST
              258.850941286554473, 13.021346299596999 ] #TEST
refESCF   = [ -303.20625701081264, -75.32040649154762,  #TEST
              -303.20499967316636, -75.32040649154514 ] #TEST
refDipY   = [ 17.7759552887,  2.2770512884, 21.6845920985,  2.2770512884 ]  #TEST
refQuadYY = [ 25.4523671288, -5.5116358496, 57.3954213176, -5.5116358496 ]  #TEST
 
molecule dimer {
0 1
C
C  1  CC
C  2  CC  1  A1
C  3  CC  2  A1   1  0
H  1  CH  2  A1   3  A2
H  4  CH  3  A1   2  A2
C  1  CC  5  A1   2  A2
C  4  CC  6  A1   3  -A2
H  2  CH  3  A1   1  A2
H  3  CH  2  A1   4  -A2
H  7  CH  8  A1   1  -A2
H  8  CH  7  A1   4  A2
--
1 1
X  1  CC  3  30   2  A2
O  13 R   1  90   2  90
H  14 OH  13 TDA  1  0
H  14 OH  15 TDA  13 A1
H  14 OH  15 TDA  13 -A1

CC    = 1.421
CH    = 1.088
A1    = 120.0
A2    = 180.0
OH    = 1.05
units angstrom
}

Rvals = [ 4.0, 5.0 ]

set globals {
    BASIS sto-3g
    DF_BASIS_SCF cc-pVDZ-JKFIT
    DIIS True
    DIIS_MIN_VECS 5
    DIIS_MAX_VECS 9
    MAXITER 1000
    E_CONVERGENCE 11
    D_CONVERGENCE 11
    GUESS SAD
    SCF_TYPE DF
    DF_BASIS_SCF cc-pVDZ-JKFIT
    REFERENCE RHF
}


count = 0                                                                                            #TEST

for R in Rvals:
    dimer.R = R

    activate(dimer)

    eehf = energy('scf')
    oe = OEProp()
    oe.set_title("BZH3O+ SCF")
    oe.add("DIPOLE")
    oe.add("QUADRUPOLE")
    oe.compute()

    compare_values(refENuc[count], dimer.nuclear_repulsion_energy(),                                 #TEST
                      9, "Nuclear repulsion energy %d" % count)                                      #TEST
    compare_values(refESCF[count], eehf, 9, "Reference energy %d" % count)                           #TEST
    compare_values(refDipY[count], get_variable("SCF DIPOLE Y"),                                     #TEST
                      5, "Y Component of Dipole %d" % count)                                         #TEST
    compare_values(refQuadYY[count], get_variable("BZH3O+ SCF QUADRUPOLE YY"),                       #TEST
                      5, "YY Component of Quadrupole %d" % count)                                    #TEST

    clean()
    count = count + 1                                                                                #TEST


    monoB = dimer.extract_subsets(2)

    eehf = energy('scf')
    oe = OEProp()
    oe.set_title("H3O+ SCF")
    oe.add("DIPOLE")
    oe.add("QUADRUPOLE")
    oe.compute()
    
    compare_values(refENuc[count], monoB.nuclear_repulsion_energy(),                                 #TEST
                      9, "Nuclear repulsion energy %d" % count)                                      #TEST
    compare_values(refESCF[count], eehf, 9, "Reference energy %d" % count)                           #TEST
    compare_values(refDipY[count], get_variable("SCF DIPOLE Y"),                                     #TEST
                      5, "Y Component of Dipole %d" % count)                                         #TEST
    compare_values(refQuadYY[count], get_variable("H3O+ SCF QUADRUPOLE YY"),                         #TEST
                      5, "YY Component of Quadrupole %d" % count)                                    #TEST

    clean()
    count = count + 1                                                                                #TEST

