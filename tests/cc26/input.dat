#! Single-point gradient, analytic and via finite-differences of 2-1A1 state of H2O with EOM-CCSD

molecule h2o {
  0 1
  H -0.107055195862289   0.000000000000000  -1.832806614599657
  O -0.107055195862289   0.000000000000000   0.094714436481352
  H  1.806098405595803   0.000000000000000   0.329620161376194
  units bohr
}

set {
  basis DZ
  dertype none
  states_per_irrep [1, 0, 0, 0]
}

gradient('eom-ccsd')
analytic_grad = PsiMod.get_gradient()

#Shows how to access elements if desired.
#nirreps = analytic_grad.nirrep()
#print "Num irreps = %d\n" % nirreps
#symmetry = analytic_grad.symmetry()
#print "Symmetry = %d\n" % symmetry
#for irrep in range(nirreps):
#  rows = analytic_grad.rows(irrep)
#  cols = analytic_grad.cols(irrep ^ symmetry)
#  for row in range(rows):
#    for col in range(cols):
#      val = analytic_grad.get(irrep, row, col)
#      print "%d %d %20.10f\n" % (row, col, val)

#Use 3-pt. formula
gradient('eom-ccsd', dertype=0)
findif_grad = PsiMod.get_gradient()

compare_matrices(analytic_grad, findif_grad, 5, "Finite-difference (3-pt.) vs. analytic gradient to 10^-5") #TEST

# Use 5-pt. formula
set findif points 5
gradient('eom-ccsd', dertype=0)
findif_grad = PsiMod.get_gradient()

compare_matrices(analytic_grad, findif_grad, 7, "Finite-difference (5-pt.) vs. analytic gradient to 10^-7") #TEST

clean()

