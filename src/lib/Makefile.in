 
.PHONY:	default all install depend clean dclean targetclean

subdirs = libint libderiv libciomr libchkpt libqt libpsio libiwl libdpd \
          libutil liboptions libmatrix libdist_matrix \
          libmints libtrans libparallel lib3index libfunctional libdisp libfock libscf_solver \
          libdiis libsapt_solver libplugin \
          libmoinfo libsmartptr libyeti

all: default

buildsubdirs       = $(subdirs:%=build-%)
installsubdirs     = $(subdirs:%=install-%)
installincsubdirs  = $(subdirs:%=installinc-%)
dependsubdirs      = $(subdirs:%=depend-%)
cleansubdirs       = $(subdirs:%=clean-%)
dcleansubdirs      = $(subdirs:%=dclean-%)
targetcleansubdirs = $(subdirs:%=targetclean-%)
.PHONY: $(buildsubdirs) $(installsubdirs) $(installincsubdirs) $(dependsubdirs) $(cleansubdirs) $(dcleansubdirs) $(targetcleansubdirs)

### SPECIAL DEPENDENCY! The act of building libderiv produces a header file that is needed by libmints. ###
build-libmints: build-libderiv

default: $(buildsubdirs)
$(buildsubdirs):
	$(MAKE) -C $(@:build-%=%) default

install: $(installsubdirs)
$(installsubdirs): all
	$(MAKE) -C $(@:install-%=%) install

install_inc: $(installincsubdirs)
$(installincsubdirs): all
	$(MAKE) -C $(@:installinc-%=%) install_inc

depend: $(dependsubdirs)
$(dependsubdirs):
	$(MAKE) -C $(@:depend-%=%) depend

clean: $(cleansubdirs)
$(cleansubdirs):
	$(MAKE) -C $(@:clean-%=%) clean

dclean: $(dcleansubdirs)
$(dcleansubdirs):
	$(MAKE) -C $(@:dclean-%=%) dclean

targetclean: $(targetcleansubdirs)
$(targetcleansubdirs):
	$(MAKE) -C $(@:targetclean-%=%) targetclean


#
# keep the configuration information and makefile up-to-date
#

top_srcdir = @top_srcdir@
srcdir = @srcdir@
top_objdir = ../..

$(top_srcdir)/configure: $(top_srcdir)/configure.ac $(top_srcdir)/aclocal.m4
	cd $(top_srcdir) && autoconf

$(top_objdir)/config.status: $(top_srcdir)/configure
	cd $(top_objdir) && ./config.status --recheck

Makefile: $(srcdir)/Makefile.in $(top_objdir)/config.status
	cd $(top_objdir) && CONFIG_FILES=src/lib/Makefile ./config.status

